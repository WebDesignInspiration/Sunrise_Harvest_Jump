<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>Simple Jump Game</title>
<style>
  html,body{height:100%;margin:0;background:#0b1222;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  .wrap{display:grid;place-items:center;height:100%}
  canvas{
    width:min(100vw,900px);
    height:min(70vh,520px);
    border-radius:14px;
    box-shadow:0 18px 50px rgba(0,0,0,.4);
    background:#bfe6ff; /* sky */
    touch-action:none;
  }
  .hud{position:absolute;top:10px;left:50%;transform:translateX(-50%);display:flex;gap:10px}
  .pill{background:#ffffffcc;border:2px solid #00000014;border-radius:999px;padding:6px 12px;font-weight:700}
  .btn{cursor:pointer}
</style>
</head>
<body>
<div class="wrap">
  <canvas id="game" width="900" height="520"></canvas>
  <div class="hud">
    <div class="pill">Score: <span id="score">0</span></div>
    <div class="pill">Best: <span id="best">0</span></div>
    <button id="restart" class="pill btn">Restart</button>
  </div>
</div>

<script>
(() => {
  const cvs = document.getElementById('game');
  const ctx = cvs.getContext('2d');
  const scoreEl = document.getElementById('score');
  const bestEl  = document.getElementById('best');
  const restartBtn = document.getElementById('restart');

  // ---------- sizing ----------
  let W=900, H=520, GY=H-80, DPR=1;
  function resize(){
    const dpr = Math.max(1, Math.min(window.devicePixelRatio||1, 3));
    DPR=dpr;
    const cssW = Math.min(window.innerWidth, 900);
    const cssH = Math.min(Math.max(window.innerHeight*0.70, 360), 520);
    cvs.style.width = cssW+'px';
    cvs.style.height= cssH+'px';
    cvs.width  = Math.floor(cssW*dpr);
    cvs.height = Math.floor(cssH*dpr);
    ctx.setTransform(dpr,0,0,dpr,0,0);
    W=cssW; H=cssH;
    GY = Math.floor(H*0.80);
    player.y = GY - player.h;
  }
  window.addEventListener('resize', resize);

  // ---------- constants for pacing ----------
  const START_SPEED = 220; // px/s
  const MAX_SPEED   = 520; // cap
  const ACCEL_PPS2  = 30;  // px/s^2 (gentle)

  // ---------- player / physics ----------
  const player = { x:120, y:0, w:40, h:40, vy:0, onGround:true, jumpHeld:false, jumpTime:0 };
  const GRAV=1800, JUMP_VY=-650, HOLD_ACC=-1400, HOLD_TIME=0.18;

  // ---------- obstacles ----------
  const obs = [];
  function spawn(){
    const width  = 40 + Math.random()*40;   // 40–80
    const height = 30 + Math.random()*40;   // 30–70

    // base gaps + mild speed scaling so it stays fair later
    const baseMin = 360, baseMax = 500;
    const extraMin = Math.max(0, (speed - START_SPEED) * 0.25);
    const extraMax = Math.max(0, (speed - START_SPEED) * 0.35);
    const gapMin = baseMin + extraMin;
    const gapMax = baseMax + extraMax;

    const lastX = obs.length ? obs[obs.length-1].x : (W + 200);
    const x = lastX + gapMin + Math.random()*(gapMax-gapMin);
    obs.push({ x, y: GY - height, w: width, h: height });
  }

  // ---------- input ----------
  let jumpPressed=false;
  function press(){ if(!player.jumpHeld){ jumpPressed=true; } player.jumpHeld=true; }
  function release(){ player.jumpHeld=false; }
  window.addEventListener('keydown', e => { if(e.code==='Space' || e.code==='ArrowUp'){ e.preventDefault(); press(); }});
  window.addEventListener('keyup',   e => { if(e.code==='Space' || e.code==='ArrowUp'){ e.preventDefault(); release(); }});
  cvs.addEventListener('pointerdown', e => { e.preventDefault(); press(); });
  cvs.addEventListener('pointerup',   e => { e.preventDefault(); release(); });

  // ---------- game state ----------
  let running=false, last=0, speed=START_SPEED, score=0, best=+(localStorage.simple_best||0);
  let dist=0, tSinceStart=0;
  bestEl.textContent = best;

  function start(){
    resize();
    running=true; last=performance.now();
    speed=START_SPEED; score=0; dist=0; tSinceStart=0;
    Object.assign(player,{ x:120, y:GY-40, vy:0, onGround:true, jumpHeld:false, jumpTime:0 });
    obs.length=0; for(let i=0;i<6;i++) spawn();
    requestAnimationFrame(loop);
  }
  restartBtn.addEventListener('click', start);

  // ---------- loop ----------
  function loop(t){
    if(!running) return;
    const dt=Math.min(0.033,(t-last)/1000); last=t;
    update(dt); draw();
    requestAnimationFrame(loop);
  }

  function end(){
    running=false;
    if(score>best){ best=score; localStorage.simple_best=best; bestEl.textContent=best; }
    setTimeout(start, 600);
  }

  function update(dt){
    // speed (time-based acceleration + 1s ease-in + cap)
    tSinceStart += dt;
    const ease = Math.min(1, tSinceStart / 1.0); // 1 second ease-in
    speed += (ACCEL_PPS2 * ease) * dt;
    if (speed > MAX_SPEED) speed = MAX_SPEED;

    // score by distance (stable on any FPS)
    dist  += speed * dt;
    score = Math.max(0, Math.floor(dist / 60));  // ~1pt per 60px
    scoreEl.textContent = score;

    // obstacles move & recycle
    for(const o of obs){ o.x -= speed*dt; }
    if(obs.length && obs[0].x + obs[0].w < -10) obs.shift();
    // keep generating with fair spacing
    if(!obs.length || obs[obs.length-1].x < W + 160) spawn();

    // jumping
    if(jumpPressed && player.onGround){
      player.vy = JUMP_VY; player.onGround=false; player.jumpTime=0;
    }
    jumpPressed=false;

    if(player.jumpHeld && player.vy<0){
      player.jumpTime += dt;
      const k = Math.max(0, 1 - player.jumpTime/HOLD_TIME);
      player.vy += HOLD_ACC * dt * k;
    }

    // gravity
    player.vy += GRAV*dt;
    player.y  += player.vy*dt;

    // ground collide
    if(player.y + player.h >= GY){
      player.y = GY - player.h;
      if(!player.onGround){ player.onGround=true; player.vy=0; }
    }

    // obstacle collisions
    for(const o of obs){
      if(player.x < o.x+o.w && player.x+player.w > o.x && player.y < o.y+o.h && player.y+player.h > o.y){
        end(); return;
      }
    }
  }

  function draw(){
    // sky
    ctx.fillStyle = '#bfe6ff';
    ctx.fillRect(0,0,W,H);
    // ground
    ctx.fillStyle = '#3aa655';
    ctx.fillRect(0,GY,W,H-GY);
    // player
    ctx.fillStyle = '#ff7a33';
    ctx.fillRect(player.x, player.y, player.w, player.h);
    ctx.fillStyle = '#222';
    ctx.fillRect(player.x+player.w-10, player.y+10, 6, 6);
    // obstacles
    ctx.fillStyle = '#654321';
    for(const o of obs){ ctx.fillRect(o.x, o.y, o.w, o.h); }
  }

  // boot
  start();
})();
</script>
</body>
</html>
